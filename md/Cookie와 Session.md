# Cookie와 Session



> **[참고]:**
>
> https://interconnection.tistory.com/74
>
> https://victorydntmd.tistory.com/286
>
> https://devuna.tistory.com/23
>
> https://m.blog.naver.com/njw1204/221641159167





## HTTP 프로토콜의 특징



### Connectionless (비연결성)

- 클라이언트가 요청을 한 후 응답을 받으면 그 연결을 끊어 버리는 특징

- 비연결성의 장점
  - 서버에서 다수의 클라이언트와 연결을 계속 유지하면 이에 따른 리소스가 많이 발생하게 됨.
  - 비연결성은 연결을 유지하기 위한 리소스를 줄여서 더 많은 연결을 할 수 있게 한다.

- 비연결성의 단점

  - 서버가 클라이언트를 기억하지 못하므로 동일한 클라이언트의 모든 요청에 대해, 

    매번 새로운 연결을 시도/해제의 과정을 거쳐야함  ->  연결/해제에 대한 오버헤드 발생

- KeepAlive

  - 오버헤드 발생에 대한 해결책으로 HTTP의 KeepAlive 속성을 사용할 수 있다.

  - KeepAlive란, 지정된 시간동안 서버와 클라이언트 사이에서 패킷 교환이 없을 경우,

    상대방의 안부를 묻기 위해 패킷을 주기적으로 보내는 것을 말한다.

    이때, 패킷에 반응이 없으면 접속을 끊는다.

  - 단점: 주기적으로 클라이언트의 상태를 체크해야 하므로, 서버가 바쁜 환경에서는 KeepAlive로 상태를 유지하기 위해 메모리를 많이 사용할 수 있다.



### Stateless (무상태)

- Connectionless로 인해 서버는 클라이언트를 식별할 수 없는데, 이를 Stateless라 한다.
  - 즉, 클라이언트의 State가 less하다 -> 클라이언트의 상태를 모른다



클라이언트의 상태를 모른다는 것은 상당히 번거롭다.

예를 들면, 쇼핑몰 사이트에 접속해 주문을 하는 요청을 날리는 클라이언트가 있다고 해보자.

클라이언트는 페이지를 바꿀때마다 로그인을 해서 인증 작업을 해야 한다.

하지만, 아래에서 살펴볼 쿠키와 세션을 사용할 경우, 한 번 로그인을 하면 그 사용자에 대한 인증을 유지하게 된다.







## 상태를 기억하는 방법



### 1. Cookie

- 쿠키란?

  - 쿠키는 클라이언트(웹 브라우저) 로컬에 저장되는 데이터 파일

  - 쿠키는 클라이언트의 상태 정보를 로컬에 저장했다가 참조한다.

  - 쿠키는 서버를 대신해 클라이언트의 상태 정보를 로컬에 저장하고,

    사용자가 요청을 할 때 해당 정보를 요청 정보와 함께 서버로 보내서 사용자를 식별할 수 있게 한다.

  

- 쿠키의 특징
  - 사용자 인증이 유효한 시간을 명시 가능, 유효 시간이 정해지면 브라우저가 종료되어도 인증이 유지됨.
  - 클라이언트에 300개까지 쿠키 저장 가능, 하나의 도메인당 20개의 값만 가질 수 있음, 하나의 쿠키 값은 4KB까지 저장 가능
  - 쿠키는 String 형태의 Key와 Value 쌍으로 구성되어 있다.
  - 브라우저마다 저장되는 쿠키가 다르다. (서버에서는 브라우저가 다르면 다른 사용자로 인식)
  - 서버에서 Response Header에 Set-Cookie 속성을 사용하면 클라이언트에 쿠키를 만들 수 있다.
  - 쿠키는 클라이언트가 따로 요청하지 않아도 브라우저가 Request시에 Request Header에 넣어서 자동으로 서버에 전송한다.



- 쿠키의 구성 요소
  - 이름: 각각의 쿠키를 구별하는 데 사용되는 이름
  - 값: 쿠키의 이름과 관련된 값
  - 유효시간: 쿠키의 유지시간
  - 도메인: 쿠키를 전송할 도메인
  - 경로: 쿠키를 전송할 요청 경로



- 쿠키의 동작 방식
  1. 클라이언트가 페이지를 요청
  2. 서버에서 쿠키를 생성
  3. HTTP 헤더에 쿠키를 포함시켜 응답
  4. 브라우저가 종료되어도 쿠키 만료 기간이 있다면 클라이언트에서 보관하고 있음
  5. 같은 요청을 할 경우 HTTP 헤더에 쿠키를 함께 보냄
  6. 서버에서 쿠키를 읽어 이전 상태 정보를 변경할 필요가 있을 때 쿠키를 업데이트하여 변경된 쿠키를 HTTP 헤더에 포함시켜 응답





**첫번째 요청**

![](https://mblogthumb-phinf.pstatic.net/MjAxOTA5MDZfMjIg/MDAxNTY3NzcyMzYwODQ4.SO_93Hz67sxB6K2ygQ7IONodFGvGFkVjv3QNBbXdQJEg.hXG6EyUdO5oWG-8CsCFENDMA0kOjlKmn13khhjLFUK8g.PNG.njw1204/SE-ae665728-9a0f-4add-93f6-49416dc645d8.png?type=w800)



**다음번 요청**

![](https://mblogthumb-phinf.pstatic.net/MjAxOTA5MDZfMjM1/MDAxNTY3NzcyMzgxMjAw.jH9wdYT_4H0RfCqfjBerKfpTtfj0y07CEo5VC3QgRrEg.wUfsGV0DzDY4wuvoIcC2QO5tEwe1uJRvynHT8jL16-og.PNG.njw1204/SE-1513e6ac-117d-47fb-87e9-c8e6d7af570e.png?type=w800)





- 쿠키의 사용 예시
  - 방문 사이트에서 로그인 시, "아이디와 비밀번호를 저장하시겠습니까?"
  - 쇼핑몰의 장바구니 기능
  - 자동 로그인, 팝업에서 "오늘 더 이상 이 창을 보지 않음" 체크



- 쿠키의 단점
  - 클라이언트가 저장하기 때문에 임의로 고치거나 지울 수도 있고, 가로채기도 쉬어 **보안에 취약함**
  - 웹 브라우저에 쿠키 거부 기능이 있어서 이용 불가능할 수도...





### 2. Session

- 세션이란?
  - 클라이언트 상태 정보를 브라우저(클라이언트)가 아닌 서버 측에 저장하는 방법



- 세션의 특징

  - 클라이언트가 요청을 보내면, 서버가 클라이언트에게 유일한 ID(**세션 ID**)를 부여해서 클라이언트를 구분한다. 

  - 웹 브라우저가 서버에 접속해서 브라우저를 종료할 때까지 인증상태를 유지한다.

    - 접속 시간에 제한을 두어 일정 시간 응답이 없다면 정보가 유지되지 않게 설정도 가능함.

  - 사용자에 대한 정보를 서버에 두기 때문에 쿠키보다 보안이 좋다.

    

- 세션의 동작 방식
  1. 클라이언트가 서버에 접속 시 세션 ID를 발급받는다.
  2. 클라이언트는 세션 ID를 쿠키 형태로 저장한다.
  3. 클라이언트는 서버에 요청할 때, 이 쿠키의 세션 ID를 서버에 전달해서 사용한다.
  4. 서버는 세션 ID를 전달받아 별다른 작업없이 세션 ID로 세션에 있는 클라이언트 상태 정보를 가져온다.
  5. 클라이언트 정보를 가지고 서버 요청을 처리하여 클라이언트에게 응답한다.



**첫번째 요청**

![](https://mblogthumb-phinf.pstatic.net/MjAxOTA5MDZfMzAw/MDAxNTY3NzcyNTY1MjE4.XOI0LQwvqAG0NAif1Kij1BhxnzTpQrgSRXobWaEZMDcg.ULZVlsrxodNKAKO1UnKWXBv6Pa0pLRFuDRcp0H9YMmMg.PNG.njw1204/image.png?type=w800)



**두 번째 요청**

![](https://mblogthumb-phinf.pstatic.net/MjAxOTA5MDZfOTcg/MDAxNTY3NzcyNTk2Njcx.HKxOaB6G5LHMfIdzP0_YUVLwM6nfS0z_OHFvv3g3_k0g.InGaemt9Aidvg6wg5MRt5JiEXF9NrPUIKSrliCPbf7cg.PNG.njw1204/image.png?type=w800)





- 세션의 사용예시
  - 로그인 같이 보안상 중요한 작업을 수행할 때 사용



- 세션의 단점
  - 사용자가 많아질수록 서버 메모리를 많이 차지하게 된다. (성능 저하의 요인)









### 쿠키와 세션의 차이

- **사용자의 정보가 저장되는 위치**
  - 쿠키: 클라이언트 쪽에 저장
  - 세션: 서버 쪽에 저장
- **보안**
  - 쿠키: 취약
  - 세션: 우수
- **요청 속도**
  - 쿠키 > 세션  (쿠키가 세션보다 빠르다)
  - 세션은 서버의 처리가 필요하기 때문에 상대적으로 느리다.
- **Life Cycle (생명 주기)**
  - 쿠키: 만료시간이 있지만 파일로 저장되기 때문에 브라우저를 종료해도 계속해서 정보가 남아 있을 수 있다. 만료기간을 넉넉하게 잡아두면 쿠키 삭제를 할 때까지 유지될 수도 있다.
  - 세션: 만료시간을 정할 수 있지만 브라우저가 종료되면 만료시간에 상관없이 삭제된다.



































